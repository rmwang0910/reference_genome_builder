# æ™ºèƒ½ä½“æ¶æ„ç‰¹æ€§è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å‚è€ƒåŸºå› ç»„æ„å»ºå·¥å…·å¦‚ä½•ä½“ç°æ™ºèƒ½ä½“æ¶æ„ã€‚

## ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“æ¶æ„ï¼Ÿ

æ™ºèƒ½ä½“ï¼ˆAgentï¼‰æ˜¯ä¸€ç§èƒ½å¤Ÿ**è‡ªä¸»æ„ŸçŸ¥ç¯å¢ƒã€åšå‡ºå†³ç­–å¹¶æ‰§è¡Œè¡ŒåŠ¨**çš„è½¯ä»¶ç³»ç»Ÿã€‚ä¸ä¼ ç»Ÿå·¥å…·ä¸åŒï¼Œæ™ºèƒ½ä½“å…·å¤‡ï¼š

1. **è‡ªä¸»æ€§ï¼ˆAutonomyï¼‰**ï¼šèƒ½å¤Ÿç‹¬ç«‹åšå‡ºå†³ç­–
2. **ååº”æ€§ï¼ˆReactivityï¼‰**ï¼šèƒ½å¤Ÿæ„ŸçŸ¥ç¯å¢ƒå˜åŒ–å¹¶åšå‡ºååº”
3. **ä¸»åŠ¨æ€§ï¼ˆProactivityï¼‰**ï¼šèƒ½å¤Ÿä¸»åŠ¨é‡‡å–è¡ŒåŠ¨è¾¾æˆç›®æ ‡
4. **ç¤¾ä¼šæ€§ï¼ˆSocial Abilityï¼‰**ï¼šèƒ½å¤Ÿä¸å…¶ä»–æ™ºèƒ½ä½“æˆ–ç”¨æˆ·äº¤äº’

## æœ¬å·¥å…·çš„æ™ºèƒ½ä½“ç‰¹æ€§

### 1. ğŸ§  è‡ªä¸»å†³ç­–èƒ½åŠ›

#### ä¼ ç»Ÿå·¥å…· vs æ™ºèƒ½ä½“

**ä¼ ç»Ÿå·¥å…·**ï¼ˆ`main.py`ï¼‰ï¼š
```bash
# ç”¨æˆ·å¿…é¡»æ˜ç¡®æŒ‡å®šæ‰€æœ‰å‚æ•°
python main.py pipeline \
  --source ensembl \
  --species human \
  --tools star \
  --threads 8 \
  --sjdb-overhang 99
```

**æ™ºèƒ½ä½“**ï¼ˆ`agent_main.py`ï¼‰ï¼š
```bash
# ç”¨æˆ·åªéœ€æè¿°éœ€æ±‚ï¼Œæ™ºèƒ½ä½“è‡ªåŠ¨å†³ç­–
python agent_main.py "æˆ‘éœ€è¦ä¸ºRNA-seqåˆ†æå‡†å¤‡äººç±»å‚è€ƒåŸºå› ç»„å’ŒSTARç´¢å¼•"
```

æ™ºèƒ½ä½“ä¼šè‡ªåŠ¨ï¼š
- âœ… è¯†åˆ«è¿™æ˜¯RNA-seqåœºæ™¯
- âœ… é€‰æ‹©Ensemblæ•°æ®æºï¼ˆæ›´é€‚åˆRNA-seqï¼‰
- âœ… é€‰æ‹©STARå·¥å…·ï¼ˆRNA-seqæœ€ä½³é€‰æ‹©ï¼‰
- âœ… è‡ªåŠ¨è®¾ç½®sjdb_overhang=99ï¼ˆæ ¹æ®å¸¸è§readé•¿åº¦ï¼‰
- âœ… è§„åˆ’ä»»åŠ¡æ­¥éª¤å¹¶æ‰§è¡Œ

#### å®ç°æ–¹å¼

```python
# agent_core.py
def plan_task(self, user_request: str) -> List[Task]:
    """ä½¿ç”¨LLMè§„åˆ’ä»»åŠ¡"""
    if self.use_llm:
        return self._plan_with_llm(user_request)  # LLMæ™ºèƒ½å†³ç­–
    else:
        return self._plan_with_rules(user_request)  # è§„åˆ™å†³ç­–
```

### 2. ğŸ“‹ ä»»åŠ¡è§„åˆ’èƒ½åŠ›

æ™ºèƒ½ä½“èƒ½å¤Ÿå°†æ¨¡ç³Šçš„ç”¨æˆ·éœ€æ±‚åˆ†è§£ä¸ºå…·ä½“çš„æ‰§è¡Œæ­¥éª¤ï¼š

#### ç¤ºä¾‹ï¼šç”¨æˆ·è¯·æ±‚
```
"æˆ‘éœ€è¦ä¸ºRNA-seqåˆ†æå‡†å¤‡äººç±»å‚è€ƒåŸºå› ç»„å’ŒSTARç´¢å¼•"
```

#### æ™ºèƒ½ä½“è§„åˆ’ç»“æœ
```json
{
  "tasks": [
    {
      "id": "task_1",
      "name": "ä¸‹è½½å‚è€ƒåŸºå› ç»„",
      "description": "ä»Ensemblä¸‹è½½äººç±»å‚è€ƒåŸºå› ç»„",
      "tool": "download",
      "parameters": {"source": "ensembl", "species": "human"}
    },
    {
      "id": "task_2",
      "name": "è§£å‹ç¼©æ–‡ä»¶",
      "description": "è§£å‹ç¼©ä¸‹è½½çš„å‚è€ƒåŸºå› ç»„æ–‡ä»¶",
      "tool": "decompress",
      "parameters": {"file_path": "{{task_1.result}}"}
    },
    {
      "id": "task_3",
      "name": "æ„å»ºSTARç´¢å¼•",
      "description": "ä½¿ç”¨STARæ„å»ºå‚è€ƒåŸºå› ç»„ç´¢å¼•",
      "tool": "build_index",
      "parameters": {
        "genome_fasta": "{{task_2.result}}",
        "tool": "star",
        "threads": 8,
        "sjdb_overhang": 99
      }
    }
  ]
}
```

**ç‰¹ç‚¹**ï¼š
- è‡ªåŠ¨è¯†åˆ«ä»»åŠ¡ä¾èµ–å…³ç³»ï¼ˆtask_2ä¾èµ–task_1çš„ç»“æœï¼‰
- ä½¿ç”¨ `{{task_X.result}}` å®ç°ä»»åŠ¡é—´æ•°æ®ä¼ é€’
- æ ¹æ®åœºæ™¯è‡ªåŠ¨è®¾ç½®æœ€ä½³å‚æ•°

### 3. ğŸ¯ æ™ºèƒ½æ¨èèƒ½åŠ›

æ™ºèƒ½ä½“èƒ½å¤Ÿæ ¹æ®ä½¿ç”¨åœºæ™¯æ¨èæœ€ä½³æ–¹æ¡ˆï¼š

#### ç¤ºä¾‹
```bash
python agent_main.py --recommend "WGSå…¨åŸºå› ç»„æµ‹åºåˆ†æ"
```

#### æ¨èç»“æœ
```
æ¨èæ–¹æ¡ˆ:
  æ•°æ®æº: ncbi_refseq
  ç†ç”±: NCBI RefSeqæ˜¯å®˜æ–¹å‚è€ƒåºåˆ—æ•°æ®åº“ï¼Œæœ€å¸¸ç”¨ï¼Œé€‚åˆWGSåˆ†æ
  ç´¢å¼•å·¥å…·: bwa
  ç†ç”±: BWAæ˜¯çŸ­è¯»é•¿åºåˆ—æ¯”å¯¹çš„æ ‡å‡†å·¥å…·ï¼Œé€Ÿåº¦å¿«ã€å†…å­˜å ç”¨é€‚ä¸­
  å‚æ•°: {'threads': 8}
```

**å®ç°æ–¹å¼**ï¼š
- **LLMæ¨¡å¼**ï¼šä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹ç†è§£åœºæ™¯ï¼Œç”Ÿæˆæ¨è
- **è§„åˆ™æ¨¡å¼**ï¼šåŸºäºçŸ¥è¯†åº“åŒ¹é…åœºæ™¯ç‰¹å¾

### 4. ğŸ”„ é”™è¯¯æ¢å¤æœºåˆ¶

æ™ºèƒ½ä½“å…·å¤‡è‡ªåŠ¨é”™è¯¯æ¢å¤èƒ½åŠ›ï¼š

#### è‡ªåŠ¨é‡è¯•
```python
# agent_core.py
def execute_task(self, task: Task) -> Any:
    try:
        result = tool_func(**parameters)
        task.status = TaskStatus.COMPLETED
    except Exception as e:
        task.status = TaskStatus.FAILED
        task.retry_count += 1
        
        # è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
        if task.retry_count < task.max_retries:
            return self.execute_task(task)
```

#### é™çº§ç­–ç•¥
å¦‚æœæŸä¸ªæ•°æ®æºå¤±è´¥ï¼Œæ™ºèƒ½ä½“å¯ä»¥ï¼š
1. è‡ªåŠ¨å°è¯•å…¶ä»–æ•°æ®æº
2. ä½¿ç”¨å¤‡ç”¨å·¥å…·
3. è°ƒæ•´å‚æ•°é‡è¯•

### 5. ğŸ“Š çŠ¶æ€ç®¡ç†

æ™ºèƒ½ä½“ç»´æŠ¤å®Œæ•´çš„æ‰§è¡ŒçŠ¶æ€ï¼š

#### çŠ¶æ€ç»“æ„
```python
AgentState:
  - current_task: å½“å‰æ‰§è¡Œçš„ä»»åŠ¡
  - tasks: æ‰€æœ‰ä»»åŠ¡åˆ—è¡¨ï¼ˆåŒ…å«çŠ¶æ€ã€ç»“æœã€é”™è¯¯ï¼‰
  - context: ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆç”¨æˆ·éœ€æ±‚ã€æ¨èæ–¹æ¡ˆç­‰ï¼‰
  - history: æ‰§è¡Œå†å²è®°å½•
```

#### çŠ¶æ€æŒä¹…åŒ–
```python
# è‡ªåŠ¨ä¿å­˜åˆ° agent_state.json
{
  "current_task": "task_3",
  "tasks": [
    {
      "id": "task_1",
      "status": "completed",
      "result": "/path/to/genome.fa.gz"
    },
    {
      "id": "task_2",
      "status": "completed",
      "result": "/path/to/genome.fa"
    },
    {
      "id": "task_3",
      "status": "in_progress"
    }
  ],
  "context": {
    "user_request": "RNA-seqåˆ†æå‡†å¤‡",
    "recommended_source": "ensembl"
  }
}
```

**ä¼˜åŠ¿**ï¼š
- æ”¯æŒä»»åŠ¡æ¢å¤ï¼ˆæ–­ç‚¹ç»­ä¼ ï¼‰
- å®Œæ•´çš„æ‰§è¡Œå†å²
- ä¾¿äºè°ƒè¯•å’Œé—®é¢˜è¯Šæ–­

### 6. ğŸ› ï¸ å·¥å…·è°ƒç”¨èƒ½åŠ›

æ™ºèƒ½ä½“é€šè¿‡å·¥å…·æ³¨å†Œæœºåˆ¶åŠ¨æ€è°ƒç”¨åŠŸèƒ½ï¼š

#### å·¥å…·æ³¨å†Œ
```python
# agent_core.py
self.tools = {
    'download': download_tool,
    'decompress': decompress_tool,
    'build_index': build_index_tool
}
```

#### åŠ¨æ€è°ƒç”¨
```python
# æ ¹æ®ä»»åŠ¡è§„åˆ’åŠ¨æ€é€‰æ‹©å·¥å…·
tool_func = self.tools.get(task.tool)
result = tool_func(**task.parameters)
```

**ç‰¹ç‚¹**ï¼š
- å·¥å…·å¯æ‰©å±•ï¼ˆæ˜“äºæ·»åŠ æ–°å·¥å…·ï¼‰
- å‚æ•°è‡ªåŠ¨è§£æ
- æ”¯æŒä»»åŠ¡é—´ç»“æœä¼ é€’

### 7. ğŸ§  LLMé›†æˆ

æ™ºèƒ½ä½“ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹å¢å¼ºå†³ç­–èƒ½åŠ›ï¼š

#### LLMçš„ä½œç”¨
1. **ç†è§£è‡ªç„¶è¯­è¨€**ï¼šå°†ç”¨æˆ·æè¿°è½¬æ¢ä¸ºç»“æ„åŒ–ä»»åŠ¡
2. **æ™ºèƒ½æ¨è**ï¼šæ ¹æ®åœºæ™¯æ¨èæœ€ä½³æ–¹æ¡ˆ
3. **å‚æ•°ä¼˜åŒ–**ï¼šæ ¹æ®å…·ä½“æƒ…å†µä¼˜åŒ–å‚æ•°

#### Promptè®¾è®¡
```python
prompt = f"""ä½ æ˜¯ä¸€ä¸ªå‚è€ƒåŸºå› ç»„æ„å»ºä¸“å®¶ã€‚æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ï¼Œè§„åˆ’å‡ºéœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æ­¥éª¤ã€‚

ç”¨æˆ·éœ€æ±‚: {user_request}

å¯ç”¨çš„å·¥å…·ï¼š
1. download - ä¸‹è½½å‚è€ƒåŸºå› ç»„
2. decompress - è§£å‹ç¼©æ–‡ä»¶
3. build_index - æ„å»ºç´¢å¼•

è¯·åˆ†æç”¨æˆ·éœ€æ±‚ï¼Œè§„åˆ’å‡ºè¯¦ç»†çš„ä»»åŠ¡æ­¥éª¤...
"""
```

#### é™çº§æœºåˆ¶
å¦‚æœLLMä¸å¯ç”¨ï¼Œè‡ªåŠ¨é™çº§åˆ°åŸºäºè§„åˆ™çš„å†³ç­–ï¼š
```python
if self.use_llm:
    return self._plan_with_llm(user_request)
else:
    return self._plan_with_rules(user_request)  # è§„åˆ™å†³ç­–
```

## æ¶æ„å¯¹æ¯”

### ä¼ ç»Ÿå·¥å…·æ¶æ„
```
ç”¨æˆ·è¾“å…¥ â†’ å‚æ•°è§£æ â†’ æ‰§è¡Œå‘½ä»¤ â†’ è¿”å›ç»“æœ
         (å›ºå®šæµç¨‹)
```

### æ™ºèƒ½ä½“æ¶æ„
```
ç”¨æˆ·è¾“å…¥ â†’ LLMç†è§£ â†’ ä»»åŠ¡è§„åˆ’ â†’ å·¥å…·è°ƒç”¨ â†’ çŠ¶æ€ç®¡ç† â†’ é”™è¯¯æ¢å¤ â†’ è¿”å›ç»“æœ
         (æ™ºèƒ½å†³ç­–)  (è‡ªåŠ¨è§„åˆ’)  (åŠ¨æ€é€‰æ‹©)  (çŠ¶æ€è·Ÿè¸ª)  (è‡ªåŠ¨é‡è¯•)
```

## ä½¿ç”¨åœºæ™¯å¯¹æ¯”

### åœºæ™¯1ï¼šRNA-seqåˆ†æå‡†å¤‡

**ä¼ ç»Ÿæ–¹å¼**ï¼š
```bash
# éœ€è¦äº†è§£ï¼š
# 1. å“ªä¸ªæ•°æ®æºé€‚åˆRNA-seqï¼Ÿ
# 2. åº”è¯¥ç”¨å“ªä¸ªå·¥å…·ï¼Ÿ
# 3. å‚æ•°å¦‚ä½•è®¾ç½®ï¼Ÿ

python main.py pipeline \
  --source ensembl \
  --species human \
  --tools star \
  --threads 8 \
  --sjdb-overhang 99
```

**æ™ºèƒ½ä½“æ–¹å¼**ï¼š
```bash
# åªéœ€æè¿°éœ€æ±‚
python agent_main.py "æˆ‘éœ€è¦ä¸ºRNA-seqåˆ†æå‡†å¤‡äººç±»å‚è€ƒåŸºå› ç»„å’ŒSTARç´¢å¼•"
```

### åœºæ™¯2ï¼šä¸ç¡®å®šæœ€ä½³æ–¹æ¡ˆ

**ä¼ ç»Ÿæ–¹å¼**ï¼š
- éœ€è¦æŸ¥é˜…æ–‡æ¡£
- éœ€è¦äº†è§£å„å·¥å…·ç‰¹ç‚¹
- éœ€è¦æ‰‹åŠ¨é€‰æ‹©

**æ™ºèƒ½ä½“æ–¹å¼**ï¼š
```bash
# ç›´æ¥è¯¢é—®æ¨è
python agent_main.py --recommend "WGSå…¨åŸºå› ç»„æµ‹åºåˆ†æ"
```

## æ€»ç»“

æœ¬å·¥å…·é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½“ç°æ™ºèƒ½ä½“æ¶æ„ï¼š

1. âœ… **è‡ªä¸»å†³ç­–**ï¼šLLMç†è§£ç”¨æˆ·æ„å›¾ï¼Œè‡ªåŠ¨åšå‡ºå†³ç­–
2. âœ… **ä»»åŠ¡è§„åˆ’**ï¼šå°†éœ€æ±‚è‡ªåŠ¨åˆ†è§£ä¸ºå¯æ‰§è¡Œæ­¥éª¤
3. âœ… **æ™ºèƒ½æ¨è**ï¼šæ ¹æ®åœºæ™¯æ¨èæœ€ä½³æ–¹æ¡ˆ
4. âœ… **é”™è¯¯æ¢å¤**ï¼šè‡ªåŠ¨é‡è¯•å’Œé™çº§ç­–ç•¥
5. âœ… **çŠ¶æ€ç®¡ç†**ï¼šå®Œæ•´çš„ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª
6. âœ… **å·¥å…·è°ƒç”¨**ï¼šåŠ¨æ€é€‰æ‹©å’Œè°ƒç”¨å·¥å…·
7. âœ… **è‡ªç„¶è¯­è¨€äº¤äº’**ï¼šé™ä½ä½¿ç”¨é—¨æ§›

è¿™ä½¿å¾—å‚è€ƒåŸºå› ç»„æ„å»ºä»**ä¼ ç»Ÿå‘½ä»¤è¡Œå·¥å…·**å‡çº§ä¸º**çœŸæ­£çš„æ™ºèƒ½åŠ©æ‰‹**ã€‚
